
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="OpenClaw's memory, everywhere â€” markdown-first semantic memory backed by Milvus">
      
      
      
        <link rel="canonical" href="https://zilliztech.github.io/memsearch/architecture/">
      
      
        <link rel="prev" href="../getting-started/">
      
      
        <link rel="next" href="../python-api/">
      
      
        
      
      
      <link rel="icon" href="../assets/logo-icon.jpg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Architecture - memsearch</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Code:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Fira Code";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/terminal.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#architecture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="memsearch" class="md-header__button md-logo" aria-label="memsearch" data-md-component="logo">
      
  <img src="../assets/logo-icon.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            memsearch
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Architecture
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/zilliztech/memsearch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    zilliztech/memsearch
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../getting-started/" class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  Architecture

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../python-api/" class="md-tabs__link">
        
  
  
    
  
  Python API

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../cli/" class="md-tabs__link">
        
  
  
    
  
  CLI Reference

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../integrations/" class="md-tabs__link">
        
  
  
    
  
  Integrations

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../claude-plugin/" class="md-tabs__link">
        
  
  
    
  
  Claude Code Plugin

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../faq/" class="md-tabs__link">
        
  
  
    
  
  FAQ

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="memsearch" class="md-nav__button md-logo" aria-label="memsearch" data-md-component="logo">
      
  <img src="../assets/logo-icon.jpg" alt="logo">

    </a>
    memsearch
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zilliztech/memsearch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    zilliztech/memsearch
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#design-philosophy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Philosophy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Design Philosophy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#markdown-as-the-source-of-truth" class="md-nav__link">
    <span class="md-ellipsis">
      
        Markdown as the Source of Truth
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspired-by-openclaw" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inspired by OpenClaw
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pipeline Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#search-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Search Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingest-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ingest Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#watch-and-compact" class="md-nav__link">
    <span class="md-ellipsis">
      
        Watch and Compact
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chunking-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunking Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chunking Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heading-based-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Heading-Based Chunking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paragraph-based-splitting-for-large-sections" class="md-nav__link">
    <span class="md-ellipsis">
      
        Paragraph-Based Splitting for Large Sections
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunk-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunk Metadata
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deduplication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deduplication
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deduplication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How It Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-this-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why This Matters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Storage Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Storage Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#collection-schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        Collection Schema
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hybrid-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hybrid Search
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#three-tier-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Three-Tier Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#physical-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Physical Isolation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#config-sections" class="md-nav__link">
    <span class="md-ellipsis">
      
        Config Sections
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flow-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Flow Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Flow Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-compact-cycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Compact Cycle
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-first-by-default" class="md-nav__link">
    <span class="md-ellipsis">
      
        Local-First by Default
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-data-leaves-your-machine" class="md-nav__link">
    <span class="md-ellipsis">
      
        When Data Leaves Your Machine
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-key-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Key Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filesystem-access" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filesystem Access
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python API
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Reference
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integrations
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../claude-plugin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Claude Code Plugin
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#design-philosophy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Philosophy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Design Philosophy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#markdown-as-the-source-of-truth" class="md-nav__link">
    <span class="md-ellipsis">
      
        Markdown as the Source of Truth
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspired-by-openclaw" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inspired by OpenClaw
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pipeline Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#search-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Search Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingest-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ingest Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#watch-and-compact" class="md-nav__link">
    <span class="md-ellipsis">
      
        Watch and Compact
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chunking-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunking Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chunking Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#heading-based-chunking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Heading-Based Chunking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paragraph-based-splitting-for-large-sections" class="md-nav__link">
    <span class="md-ellipsis">
      
        Paragraph-Based Splitting for Large Sections
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunk-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunk Metadata
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deduplication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deduplication
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deduplication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How It Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-this-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why This Matters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Storage Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Storage Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#collection-schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        Collection Schema
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hybrid-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hybrid Search
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#three-tier-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Three-Tier Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#physical-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Physical Isolation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#config-sections" class="md-nav__link">
    <span class="md-ellipsis">
      
        Config Sections
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flow-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Flow Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Flow Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-compact-cycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Compact Cycle
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-first-by-default" class="md-nav__link">
    <span class="md-ellipsis">
      
        Local-First by Default
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-data-leaves-your-machine" class="md-nav__link">
    <span class="md-ellipsis">
      
        When Data Leaves Your Machine
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-key-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Key Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filesystem-access" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filesystem Access
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="architecture">Architecture<a class="headerlink" href="#architecture" title="Permanent link">&para;</a></h1>
<p>This page explains the architecture, design philosophy, and key implementation decisions behind memsearch.</p>
<hr />
<h2 id="design-philosophy">Design Philosophy<a class="headerlink" href="#design-philosophy" title="Permanent link">&para;</a></h2>
<h3 id="markdown-as-the-source-of-truth">Markdown as the Source of Truth<a class="headerlink" href="#markdown-as-the-source-of-truth" title="Permanent link">&para;</a></h3>
<p>The foundational principle of memsearch is simple: <strong>markdown files are the canonical data store</strong>. The vector database is a derived index -- it can be dropped and rebuilt at any time from the markdown files on disk. This is the same philosophy used by <a href="https://github.com/openclaw/openclaw">OpenClaw</a>'s memory system, and memsearch is designed as a standalone library inspired by that architecture.</p>
<p><strong>Why markdown?</strong></p>
<ul>
<li><strong>Human-readable.</strong> Any developer can open a memory file in any text editor and understand what the agent knows. There is no binary format to decode, no special viewer required.</li>
<li><strong>Git-friendly.</strong> Markdown diffs are clean and meaningful. You get full version history, blame, branching, and merge conflict resolution for free -- the same tools you already use for code.</li>
<li><strong>Zero vendor lock-in.</strong> Markdown is a plain-text format that has been stable for decades. If you stop using memsearch tomorrow, your knowledge base is still right there on disk, fully intact.</li>
<li><strong>Trivially portable.</strong> Copy the files to another machine, another tool, another agent framework. No export step, no migration script, no schema translation.</li>
</ul>
<p><strong>Why NOT a database as the source of truth?</strong></p>
<ul>
<li><strong>Opaque.</strong> Database files are binary blobs that require specific software to read. If the tool disappears, so does easy access to your data.</li>
<li><strong>Vendor lock-in.</strong> Each database engine has its own storage format, query language, and migration tooling. Switching costs are high.</li>
<li><strong>Fragile.</strong> Database corruption, version incompatibilities, and backup complexity are real operational concerns for what should be a simple knowledge store.</li>
</ul>
<p>In memsearch, the vector store is an acceleration layer -- nothing more. If the <a href="https://milvus.io/">Milvus</a> database is lost, corrupted, or simply out of date, a single <code>memsearch index</code> command rebuilds the entire index from the markdown files.</p>
<pre class="mermaid"><code>graph LR
    MD["Markdown Files&lt;br&gt;(source of truth)"] --&gt;|index| MIL[(Milvus&lt;br&gt;derived index)]
    MIL --&gt;|lost or corrupted?| REBUILD["memsearch index&lt;br&gt;(full rebuild)"]
    REBUILD --&gt; MIL

    style MD fill:#2a3a5c,stroke:#e0976b,color:#a8b2c1
    style MIL fill:#2a3a5c,stroke:#6ba3d6,color:#a8b2c1</code></pre>
<h3 id="inspired-by-openclaw">Inspired by OpenClaw<a class="headerlink" href="#inspired-by-openclaw" title="Permanent link">&para;</a></h3>
<p>memsearch follows <a href="https://github.com/openclaw/openclaw">OpenClaw</a>'s memory architecture precisely:</p>
<table>
<thead>
<tr>
<th>Concept</th>
<th>OpenClaw</th>
<th>memsearch</th>
</tr>
</thead>
<tbody>
<tr>
<td>Memory layout</td>
<td><code>MEMORY.md</code> + <code>memory/YYYY-MM-DD.md</code></td>
<td>Same</td>
</tr>
<tr>
<td>Chunk ID format</td>
<td><code>hash(source:startLine:endLine:contentHash:model)</code></td>
<td>Same</td>
</tr>
<tr>
<td>Dedup strategy</td>
<td>Content-hash primary key</td>
<td>Same</td>
</tr>
<tr>
<td>Compact target</td>
<td>Append to daily markdown log</td>
<td>Same</td>
</tr>
<tr>
<td>Source of truth</td>
<td>Markdown files (vector DB is derived)</td>
<td>Same</td>
</tr>
<tr>
<td>File watch debounce</td>
<td>1500ms</td>
<td>Same default</td>
</tr>
</tbody>
</table>
<p>If you are already using OpenClaw's memory directory layout, memsearch works with it directly -- no migration needed.</p>
<hr />
<h2 id="pipeline-overview">Pipeline Overview<a class="headerlink" href="#pipeline-overview" title="Permanent link">&para;</a></h2>
<h3 id="search-flow">Search Flow<a class="headerlink" href="#search-flow" title="Permanent link">&para;</a></h3>
<p>When a query arrives, it is embedded into a vector, then used for hybrid search (dense cosine similarity + BM25 full-text) against the Milvus collection. Results are reranked using Reciprocal Rank Fusion (RRF) and returned with source metadata.</p>
<pre class="mermaid"><code>graph LR
    Q[/"Query"/] --&gt; E[Embed query] --&gt; HS["Hybrid Search&lt;br&gt;(Dense + BM25)"]
    HS --&gt; RRF["RRF Reranker&lt;br&gt;(k=60)"] --&gt; R[Top-K Results]

    subgraph Milvus
        HS
        RRF
    end</code></pre>
<h3 id="ingest-flow">Ingest Flow<a class="headerlink" href="#ingest-flow" title="Permanent link">&para;</a></h3>
<p>Markdown files are scanned, chunked by headings, and deduplicated using SHA-256 content hashes. Only new or changed chunks are sent to the embedding API and upserted into Milvus. Chunks from deleted files are automatically cleaned up.</p>
<pre class="mermaid"><code>graph LR
    F["Markdown files"] --&gt; SC[Scanner] --&gt; C[Chunker] --&gt; D{"Dedup&lt;br&gt;(SHA-256)"}
    D --&gt;|new| E[Embed &amp; Upsert]
    D --&gt;|exists| S[Skip]
    D --&gt;|stale| DEL[Delete from Milvus]</code></pre>
<h3 id="watch-and-compact">Watch and Compact<a class="headerlink" href="#watch-and-compact" title="Permanent link">&para;</a></h3>
<p>The file watcher monitors directories for markdown changes and automatically re-indexes modified files. The compact operation compresses indexed chunks into an LLM-generated summary and writes it back to a daily markdown log -- which the watcher then picks up and indexes, closing the loop.</p>
<pre class="mermaid"><code>graph LR
    W[File Watcher] --&gt;|1500ms debounce| I[Auto re-index]
    FL[Compact] --&gt; L[LLM Summarize] --&gt; MD["memory/YYYY-MM-DD.md"]
    MD -.-&gt;|triggers| W</code></pre>
<hr />
<h2 id="chunking-strategy">Chunking Strategy<a class="headerlink" href="#chunking-strategy" title="Permanent link">&para;</a></h2>
<p>memsearch splits markdown files into semantic chunks using a heading-based strategy, with paragraph-level fallback for oversized sections.</p>
<h3 id="heading-based-chunking">Heading-Based Chunking<a class="headerlink" href="#heading-based-chunking" title="Permanent link">&para;</a></h3>
<p>The chunker treats markdown headings (<code>#</code> through <code>######</code>) as natural chunk boundaries. Each heading and the content below it (up to the next heading of equal or higher level) becomes one chunk. Content before the first heading (the "preamble") is treated as its own chunk.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a># Project Notes                    &lt;-- preamble chunk starts here
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>Some introductory text.
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>## Redis Configuration              &lt;-- chunk boundary
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>We chose Redis for caching...
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>### Connection Settings              &lt;-- chunk boundary
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>host=localhost, port=6379...
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>## Authentication                    &lt;-- chunk boundary
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>We use JWT tokens...
</code></pre></div>
<h3 id="paragraph-based-splitting-for-large-sections">Paragraph-Based Splitting for Large Sections<a class="headerlink" href="#paragraph-based-splitting-for-large-sections" title="Permanent link">&para;</a></h3>
<p>When a heading-delimited section exceeds <code>max_chunk_size</code> (default: 1500 characters), the chunker splits it further at paragraph boundaries (blank lines). A configurable <code>overlap_lines</code> (default: 2 lines) is carried forward between sub-chunks to preserve context continuity.</p>
<h3 id="chunk-metadata">Chunk Metadata<a class="headerlink" href="#chunk-metadata" title="Permanent link">&para;</a></h3>
<p>Each chunk carries rich metadata for provenance tracking:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>content</code></td>
<td>The raw text of the chunk</td>
</tr>
<tr>
<td><code>source</code></td>
<td>Absolute file path the chunk was extracted from</td>
</tr>
<tr>
<td><code>heading</code></td>
<td>The nearest heading text (empty string for preamble)</td>
</tr>
<tr>
<td><code>heading_level</code></td>
<td>Heading depth: 1--6 for <code>#</code>--<code>######</code>, 0 for preamble</td>
</tr>
<tr>
<td><code>start_line</code></td>
<td>First line number in the source file (1-indexed)</td>
</tr>
<tr>
<td><code>end_line</code></td>
<td>Last line number in the source file</td>
</tr>
<tr>
<td><code>content_hash</code></td>
<td>Truncated SHA-256 hash of the chunk content (16 hex chars)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="deduplication">Deduplication<a class="headerlink" href="#deduplication" title="Permanent link">&para;</a></h2>
<p>memsearch uses content-addressable storage to avoid redundant embedding API calls and duplicate data in the vector store.</p>
<h3 id="how-it-works">How It Works<a class="headerlink" href="#how-it-works" title="Permanent link">&para;</a></h3>
<ol>
<li>Each chunk's content is hashed with <a href="https://en.wikipedia.org/wiki/SHA-2">SHA-256</a> (truncated to 16 hex characters).</li>
<li>A composite chunk ID is computed from the source path, line range, content hash, and embedding model name -- matching OpenClaw's format: <code>hash(markdown:source:startLine:endLine:contentHash:model)</code>.</li>
<li>Before embedding, the set of existing chunk IDs for the source file is queried from Milvus.</li>
<li>Only chunks whose composite ID is <strong>not</strong> already present get embedded and upserted.</li>
<li>Chunks whose composite ID <strong>no longer appears</strong> in the re-chunked file are deleted (stale chunk cleanup).</li>
</ol>
<pre class="mermaid"><code>graph TD
    C["Chunk content"] --&gt; H["SHA-256&lt;br&gt;(content_hash)"]
    H --&gt; CID["Composite ID&lt;br&gt;hash(source:lines:contentHash:model)"]
    CID --&gt; CHECK{"Exists in&lt;br&gt;Milvus?"}
    CHECK --&gt;|No| EMBED["Embed &amp; Upsert"]
    CHECK --&gt;|Yes| SKIP["Skip&lt;br&gt;(save API cost)"]</code></pre>
<h3 id="why-this-matters">Why This Matters<a class="headerlink" href="#why-this-matters" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>No external cache needed.</strong> The hash IS the primary key in Milvus. There is no SQLite sidecar database, no Redis cache, no <code>.json</code> tracking file. The deduplication mechanism is the storage key itself.</li>
<li><strong>Incremental indexing.</strong> Re-running <code>memsearch index</code> on an unchanged knowledge base produces zero embedding API calls. Only genuinely new or modified content is processed.</li>
<li><strong>Cost savings.</strong> Embedding API calls are the primary cost of running a semantic search system. Content-addressable dedup ensures you never pay to embed the same content twice.</li>
</ul>
<hr />
<h2 id="storage-architecture">Storage Architecture<a class="headerlink" href="#storage-architecture" title="Permanent link">&para;</a></h2>
<h3 id="collection-schema">Collection Schema<a class="headerlink" href="#collection-schema" title="Permanent link">&para;</a></h3>
<p>All chunks are stored in a single Milvus collection named <code>memsearch_chunks</code> (configurable). The schema uses both dense and sparse vector fields to enable hybrid search:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>chunk_hash</code></td>
<td><code>VARCHAR(64)</code></td>
<td><strong>Primary key</strong> -- composite SHA-256 chunk ID</td>
</tr>
<tr>
<td><code>embedding</code></td>
<td><code>FLOAT_VECTOR</code></td>
<td>Dense embedding from the configured provider</td>
</tr>
<tr>
<td><code>content</code></td>
<td><code>VARCHAR(65535)</code></td>
<td>Raw chunk text (also feeds BM25 via Milvus Function)</td>
</tr>
<tr>
<td><code>sparse_vector</code></td>
<td><code>SPARSE_FLOAT_VECTOR</code></td>
<td>Auto-generated BM25 sparse vector</td>
</tr>
<tr>
<td><code>source</code></td>
<td><code>VARCHAR(1024)</code></td>
<td>File path the chunk was extracted from</td>
</tr>
<tr>
<td><code>heading</code></td>
<td><code>VARCHAR(1024)</code></td>
<td>Nearest heading text</td>
</tr>
<tr>
<td><code>heading_level</code></td>
<td><code>INT64</code></td>
<td>Heading depth (0 = preamble)</td>
</tr>
<tr>
<td><code>start_line</code></td>
<td><code>INT64</code></td>
<td>First line number in source file</td>
</tr>
<tr>
<td><code>end_line</code></td>
<td><code>INT64</code></td>
<td>Last line number in source file</td>
</tr>
</tbody>
</table>
<p>The <code>sparse_vector</code> field is populated automatically by a Milvus BM25 Function that processes the <code>content</code> field -- no application-side sparse encoding is needed.</p>
<h3 id="hybrid-search">Hybrid Search<a class="headerlink" href="#hybrid-search" title="Permanent link">&para;</a></h3>
<p>Search combines two retrieval strategies and merges their results:</p>
<ol>
<li><strong>Dense vector search</strong> -- cosine similarity on the <code>embedding</code> field (semantic meaning).</li>
<li><strong><a href="https://en.wikipedia.org/wiki/Okapi_BM25">BM25</a> sparse search</strong> -- keyword matching on the <code>sparse_vector</code> field (exact term overlap).</li>
<li><strong><a href="https://en.wikipedia.org/wiki/Reciprocal_rank_fusion">RRF</a> reranking</strong> -- Reciprocal Rank Fusion with k=60 merges the two ranked lists into a single result set.</li>
</ol>
<p>This hybrid approach catches results that pure semantic search might miss (exact names, error codes, configuration values) while still benefiting from the semantic understanding that dense embeddings provide.</p>
<h3 id="three-tier-deployment">Three-Tier Deployment<a class="headerlink" href="#three-tier-deployment" title="Permanent link">&para;</a></h3>
<p>memsearch supports three Milvus deployment modes. Switch between them by changing a single parameter (<code>milvus_uri</code>):</p>
<pre class="mermaid"><code>graph TD
    A["memsearch"] --&gt; B{"milvus_uri"}
    B --&gt;|"~/.memsearch/milvus.db&lt;br&gt;(default)"| C["Milvus Lite&lt;br&gt;Local .db file&lt;br&gt;Zero config"]
    B --&gt;|"http://host:19530"| D["Milvus Server&lt;br&gt;Self-hosted&lt;br&gt;Docker / K8s"]
    B --&gt;|"https://...zillizcloud.com"| E["Zilliz Cloud&lt;br&gt;Fully managed&lt;br&gt;Auto-scaling"]

    style C fill:#2a3a5c,stroke:#6ba3d6,color:#a8b2c1
    style D fill:#2a3a5c,stroke:#6ba3d6,color:#a8b2c1
    style E fill:#2a3a5c,stroke:#e0976b,color:#a8b2c1</code></pre>
<table>
<thead>
<tr>
<th>Tier</th>
<th>URI Pattern</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Milvus Lite</strong></td>
<td><code>~/.memsearch/milvus.db</code></td>
<td>Personal use, single agent, development. No server to install.</td>
</tr>
<tr>
<td><strong>Milvus Server</strong></td>
<td><code>http://localhost:19530</code></td>
<td>Multi-agent teams, shared infrastructure, CI/CD. Deploy via Docker or Kubernetes.</td>
</tr>
<tr>
<td><strong>Zilliz Cloud</strong></td>
<td><code>https://...zillizcloud.com</code></td>
<td>Production SaaS, zero-ops, auto-scaling. Free tier available at <a href="https://cloud.zilliz.com">cloud.zilliz.com</a>.</td>
</tr>
</tbody>
</table>
<h3 id="physical-isolation">Physical Isolation<a class="headerlink" href="#physical-isolation" title="Permanent link">&para;</a></h3>
<p>All agents and projects share the same collection name (<code>memsearch_chunks</code>) by default. Physical isolation between agents is achieved by pointing each one to a <strong>different <code>milvus_uri</code></strong> -- each agent gets its own Milvus Lite database file, its own Milvus server, or its own Zilliz Cloud cluster. This avoids the complexity of multi-tenant collection management while keeping the schema simple.</p>
<hr />
<h2 id="configuration-system">Configuration System<a class="headerlink" href="#configuration-system" title="Permanent link">&para;</a></h2>
<p>memsearch uses a 4-layer configuration system. Each layer overrides the one before it:</p>
<pre class="mermaid"><code>graph LR
    D["1. Defaults"] --&gt; G["2. Global Config&lt;br&gt;~/.memsearch/config.toml"]
    G --&gt; P["3. Project Config&lt;br&gt;.memsearch.toml"]
    P --&gt; C["4. CLI Flags&lt;br&gt;--milvus-uri, etc."]</code></pre>
<table>
<thead>
<tr>
<th>Priority</th>
<th>Source</th>
<th>Scope</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 (lowest)</td>
<td>Built-in defaults</td>
<td>Hardcoded</td>
<td><code>milvus.uri = ~/.memsearch/milvus.db</code></td>
</tr>
<tr>
<td>2</td>
<td><code>~/.memsearch/config.toml</code></td>
<td>User-global</td>
<td>Shared across all projects</td>
</tr>
<tr>
<td>3</td>
<td><code>.memsearch.toml</code></td>
<td>Per-project</td>
<td>Committed to the repo or gitignored</td>
</tr>
<tr>
<td>4 (highest)</td>
<td>CLI flags</td>
<td>Per-command</td>
<td><code>--milvus-uri http://...</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note:</strong> API keys for embedding and LLM providers (e.g. <code>OPENAI_API_KEY</code>, <code>GOOGLE_API_KEY</code>) are read from environment variables by their respective SDKs. They are not part of the memsearch configuration system and are never written to config files.</p>
</blockquote>
<h3 id="config-sections">Config Sections<a class="headerlink" href="#config-sections" title="Permanent link">&para;</a></h3>
<p>The full configuration is organized into five sections:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">[milvus]</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;~/.memsearch/milvus.db&quot;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">collection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;memsearch_chunks&quot;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="k">[embedding]</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="n">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;openai&quot;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w">                           </span><span class="c1"># empty = provider default</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="k">[compact]</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="n">llm_provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;openai&quot;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="n">llm_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w">                       </span><span class="c1"># empty = provider default</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="n">prompt_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w">                     </span><span class="c1"># custom prompt template path</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="k">[chunking]</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="n">max_chunk_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1500</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="n">overlap_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="k">[watch]</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="n">debounce_ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1500</span>
</code></pre></div>
<hr />
<h2 id="data-flow-overview">Data Flow Overview<a class="headerlink" href="#data-flow-overview" title="Permanent link">&para;</a></h2>
<p>The following diagram shows the complete data flow from source-of-truth markdown files through processing and into the derived vector store:</p>
<pre class="mermaid"><code>graph TB
    subgraph "Source of Truth"
        MEM["MEMORY.md"]
        D1["memory/2026-02-08.md"]
        D2["memory/2026-02-09.md"]
    end

    subgraph "Processing"
        SCAN[Scanner] --&gt; CHUNK[Chunker]
        CHUNK --&gt; HASH["SHA-256&lt;br&gt;Dedup"]
    end

    subgraph "Storage (derived)"
        EMB[Embedding API] --&gt; MIL[(Milvus)]
    end

    MEM &amp; D1 &amp; D2 --&gt; SCAN
    HASH --&gt;|new chunks| EMB
    MIL --&gt;|search| RES[Results]

    style MEM fill:#2a3a5c,stroke:#e0976b,color:#a8b2c1
    style D1 fill:#2a3a5c,stroke:#e0976b,color:#a8b2c1
    style D2 fill:#2a3a5c,stroke:#e0976b,color:#a8b2c1
    style MIL fill:#2a3a5c,stroke:#6ba3d6,color:#a8b2c1</code></pre>
<h3 id="the-compact-cycle">The Compact Cycle<a class="headerlink" href="#the-compact-cycle" title="Permanent link">&para;</a></h3>
<p>The compact operation creates a feedback loop that keeps the knowledge base compact:</p>
<pre class="mermaid"><code>graph LR
    CHUNKS["Indexed chunks&lt;br&gt;in Milvus"] --&gt; RETRIEVE["Retrieve all&lt;br&gt;(or filtered)"]
    RETRIEVE --&gt; LLM["LLM Summarize&lt;br&gt;(OpenAI / Anthropic / Gemini)"]
    LLM --&gt; WRITE["Append to&lt;br&gt;memory/YYYY-MM-DD.md"]
    WRITE --&gt; WATCH["File watcher&lt;br&gt;detects change"]
    WATCH --&gt; REINDEX["Auto re-index&lt;br&gt;updated file"]
    REINDEX --&gt; CHUNKS

    style WRITE fill:#2a3a5c,stroke:#e0976b,color:#a8b2c1
    style CHUNKS fill:#2a3a5c,stroke:#6ba3d6,color:#a8b2c1</code></pre>
<ol>
<li>All (or filtered) chunks are retrieved from Milvus.</li>
<li>An LLM compresses them into a concise summary preserving key facts, decisions, and code patterns.</li>
<li>The summary is appended to a daily markdown log (<code>memory/YYYY-MM-DD.md</code>).</li>
<li>The file watcher detects the change and re-indexes the updated file.</li>
<li>The cycle completes: the compressed knowledge is now searchable, and the source-of-truth markdown has the full history.</li>
</ol>
<hr />
<h2 id="security">Security<a class="headerlink" href="#security" title="Permanent link">&para;</a></h2>
<h3 id="local-first-by-default">Local-First by Default<a class="headerlink" href="#local-first-by-default" title="Permanent link">&para;</a></h3>
<p>The entire memsearch pipeline runs locally by default:</p>
<ul>
<li><strong>Milvus Lite</strong> stores data in a local <code>.db</code> file on your filesystem.</li>
<li><strong>Local embedding providers</strong> (<code>memsearch[local]</code> with sentence-transformers, or <code>memsearch[ollama]</code> with a local Ollama server) process text without any network calls.</li>
</ul>
<p>In a fully local configuration, your data never leaves your machine.</p>
<h3 id="when-data-leaves-your-machine">When Data Leaves Your Machine<a class="headerlink" href="#when-data-leaves-your-machine" title="Permanent link">&para;</a></h3>
<p>Data is transmitted externally only when you explicitly choose a remote component:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Local Option</th>
<th>Remote Option</th>
</tr>
</thead>
<tbody>
<tr>
<td>Vector store</td>
<td>Milvus Lite (default)</td>
<td>Milvus Server, Zilliz Cloud</td>
</tr>
<tr>
<td>Embeddings</td>
<td><code>local</code>, <code>ollama</code></td>
<td><code>openai</code>, <code>google</code>, <code>voyage</code></td>
</tr>
<tr>
<td>Compact LLM</td>
<td>Ollama (local)</td>
<td>OpenAI, Anthropic, Gemini</td>
</tr>
</tbody>
</table>
<h3 id="api-key-handling">API Key Handling<a class="headerlink" href="#api-key-handling" title="Permanent link">&para;</a></h3>
<p>API keys are read from standard environment variables (<code>OPENAI_API_KEY</code>, <code>GOOGLE_API_KEY</code>, <code>VOYAGE_API_KEY</code>, <code>ANTHROPIC_API_KEY</code>). They are never written to config files by memsearch, never logged, and never stored in the vector database.</p>
<h3 id="filesystem-access">Filesystem Access<a class="headerlink" href="#filesystem-access" title="Permanent link">&para;</a></h3>
<p>memsearch reads only the directories and files you explicitly configure via <code>paths</code>. It does not scan outside those paths. Hidden files and directories (those starting with <code>.</code>) are skipped by default during scanning.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "search.highlight", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>